<!DOCTYPE html>
<html lang="ja" prefix="og: http://ogp.me/ns#">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N2X0B9FEPB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-N2X0B9FEPB');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>é­å¿—å€­äººä¼ãƒ»å¤ä»£ä¸­å›½èªç™ºéŸ³ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ | Ancient Japanese & Chinese Pronunciation Player</title>
    <meta name="description" content="é‚ªé¦¬å°å›½ï¼ˆé‚ªé¦¬å£¹å›½ï¼‰ã€å‘å¼¥å‘¼ã€å®˜è·åãªã©ã®å¤ä»£æ—¥æœ¬èªï¼ˆæ™©æœŸä¸Šå¤éŸ³ã€3ä¸–ç´€æ¨å®šéŸ³ï¼‰ãŠã‚ˆã³ä¸­å›½èªï¼ˆä¸­å¤éŸ³ï¼‰ã®å†æ§‹éŸ³å£°ã‚’ã€IPAï¼ˆå›½éš›éŸ³å£°è¨˜å·ï¼‰ã‚’ç”¨ã„ã¦å†ç”Ÿãƒ»æ¯”è¼ƒã§ãã‚‹å­¦ç¿’ç”¨Webãƒ„ãƒ¼ãƒ«ã§ã™ã€‚">
    <meta name="keywords" content="å¤ä»£æ—¥æœ¬èª, ä¸Šå¤éŸ³, ä¸­å¤éŸ³, é‚ªé¦¬å°å›½, å‘å¼¥å‘¼, é­å¿—å€­äººä¼, IPA, ç™ºéŸ³, å†æ§‹, 3ä¸–ç´€, éŸ³å£°åˆæˆ, Baxter-Sagart, åˆ‡éŸ»">
    <meta name="author" content="Masahiro Miyazaki">
    <meta name="robots" content="index, follow">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://masahiromiyazaki.github.io/-ancient-history-of-japan/player.html">

    <style>
        :root {
            --primary: #4a90e2;
            --primary-dark: #357abd;
            --accent: #f5a623;
            --danger: #e53e3e;
            --seq-btn: #8e44ad;
            --bg-grad-start: #f5f7fa;
            --bg-grad-end: #c3cfe2;
            --panel-bg: #ffffff;
            --text-main: #333;
            --text-sub: #666;
            --border: #e1e4e8;
        }

        * { box-sizing: border-box; }
        
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-grad-start) 0%, var(--bg-grad-end) 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-main);
        }

        .container {
            background: var(--panel-bg);
            width: 95%;
            max-width: 1100px;
            height: 90vh;
            max-height: 850px;
            border-radius: 12px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Header */
        header {
            padding: 1rem 1.5rem;
            background: #fff;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .header-titles h1 { margin: 0; font-size: 1.25rem; color: #2c3e50; font-weight: 600; }
        .header-titles .subtitle { color: var(--text-sub); font-size: 0.75rem; margin-top: 4px; }

        /* Main Layout */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* Left Panel */
        .left-panel {
            width: 320px;
            background: #f8f9fa;
            padding: 1.2rem;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            flex-shrink: 0;
            overflow-y: auto;
        }

        /* Right Panel */
        .right-panel {
            flex: 1;
            padding: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .section-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #8898aa;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            display: block;
        }

        /* Period Selector */
        .period-selector { display: flex; flex-direction: column; gap: 8px; }
        .period-card {
            background: white; border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px;
            cursor: pointer; transition: all 0.2s; position: relative;
        }
        .period-card:hover { border-color: var(--primary); transform: translateY(-1px); }
        .period-card.active {
            border-color: var(--primary); background: #ebf4ff; box-shadow: 0 2px 5px rgba(74, 144, 226, 0.2);
        }
        .period-card input { display: none; }
        
        .p-name { font-weight: 600; font-size: 0.9rem; color: #2c3e50; display: block;}
        
        .year-text {
            color: var(--accent); font-size: 0.85em; font-weight: normal; margin-left: 6px;
        }

        .p-desc { font-size: 0.7rem; color: var(--text-sub); margin-top: 2px; display: block;}

        .check-icon {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            color: var(--primary); opacity: 0; transition: opacity 0.2s;
        }
        .period-card.active .check-icon { opacity: 1; }

        /* Reference Link */
        .reference-box {
            background: #eef6fc; border: 1px solid #d0e3f5; padding: 12px; border-radius: 8px;
            font-size: 0.8rem; color: #2c5282; line-height: 1.5;
        }
        .reference-box a {
            color: #3182ce; font-weight: bold; text-decoration: none; display: block; margin-top: 4px;
        }
        .reference-box a:hover { text-decoration: underline; }

        /* Warning Box */
        .info-box {
            padding: 0.8rem; background: #fff8e1; border: 1px solid #ffe082;
            border-radius: 6px; font-size: 0.75rem; color: #856404; line-height: 1.5;
        }
        .info-box h4 { margin: 0 0 6px 0; font-size: 0.8rem; }
        .info-box ul { margin: 0; padding-left: 1.2rem; }
        .info-box li { margin-bottom: 4px; }

        /* Audio Controls */
        .audio-controls {
            background: white; padding: 12px; border-radius: 8px; border: 1px solid var(--border);
        }
        .slider-group { margin-bottom: 12px; }
        .slider-group:last-child { margin-bottom: 0; }
        .slider-label {
            display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 4px; color: var(--text-sub);
        }
        input[type=range] {
            width: 100%; height: 4px; background: #ddd; border-radius: 2px; outline: none; -webkit-appearance: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 14px; height: 14px; background: var(--primary);
            border-radius: 50%; cursor: pointer; transition: background 0.2s;
        }
        select.voice-select {
            width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.8rem; margin-top: 4px;
            background: #fdfdfd;
        }

        /* Player Area */
        .player-area {
            padding: 1.2rem; background: white; border-bottom: 1px solid var(--border); flex-shrink: 0;
            display: flex; flex-direction: column; gap: 10px;
        }
        
        /* ãƒãƒƒã‚¸ */
        .badge-container {
            display: flex; align-items: center; flex-wrap: wrap; gap: 8px; margin-bottom: 0.5rem;
        }
        .selected-word-badge, .selected-period-badge {
            font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; font-weight: 600; border: 1px solid; display: none;
        }
        .selected-word-badge { color: var(--primary-dark); background: #eef6fc; border-color: #d0e3f5; }
        .selected-period-badge { color: #d97706; background: #fffaf0; border-color: #fbd38d; }

        /* ãƒœã‚¿ãƒ³å…±é€š */
        .sm-btn {
            background: transparent; border: 1px solid #ccc; border-radius: 4px; font-size: 0.75rem;
            cursor: pointer; padding: 3px 10px; color: #555; display: flex; align-items: center; gap: 5px;
            transition: all 0.2s; text-decoration: none;
        }
        .sm-btn:hover { background: #f0f0f0; color: #333; }
        .copy-link-btn.copied { border-color: var(--primary); color: var(--primary); background: #f0f8ff; }
        .x-share-btn:hover { background: #000; color: #fff; border-color: #000; } 

        textarea {
            width: 100%; min-height: 70px; height: 70px; padding: 10px; font-size: 1.1rem;
            border: 1px solid var(--border); border-radius: 8px; resize: none;
            font-family: 'Segoe UI', sans-serif; background: #fdfdfd; transition: border-color 0.2s;
        }
        textarea:focus { outline: none; border-color: var(--primary); background: white; }

        .controls-row { display: flex; align-items: center; gap: 10px; }
        .status-badge {
            flex: 1; display: flex; align-items: center; background: #f0f4ff; color: var(--primary-dark);
            padding: 0 12px; height: 40px; border-radius: 6px; font-size: 0.8rem; font-weight: 600;
            overflow: hidden; white-space: nowrap;
        }
        .sound-bars {
            display: flex; align-items: flex-end; gap: 3px; height: 16px; margin-left: auto;
        }
        .bar { width: 4px; height: 3px; background-color: #cbd5e0; border-radius: 2px; }
        .playing .bar {
            background-color: var(--primary); animation: bounce 0.5s infinite ease-in-out;
        }
        .playing .bar:nth-child(1) { animation-delay: 0.0s; }
        .playing .bar:nth-child(2) { animation-delay: 0.1s; }
        .playing .bar:nth-child(3) { animation-delay: 0.3s; }
        .playing .bar:nth-child(4) { animation-delay: 0.2s; }
        .playing .bar:nth-child(5) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 100% { height: 3px; } 50% { height: 16px; } }

        .btn-group { display: flex; gap: 8px; }
        .btn {
            border: none; padding: 0 16px; height: 40px; border-radius: 6px; font-weight: 500;
            cursor: pointer; font-size: 0.85rem; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .btn-play { background: var(--primary); color: white; }
        .btn-play:hover { background: var(--primary-dark); }
        .btn-stop { background: #e2e8f0; color: #4a5568; }
        .btn-stop:hover { background: #cbd5e0; }
        .btn-seq { background: #f3e5f5; color: var(--seq-btn); border: 1px solid #e1bee7; }
        .btn-seq:hover { background: #e1bee7; }
        .btn-seq.active { background: var(--seq-btn); color: white; border-color: var(--seq-btn); }

        .preview-line {
            font-size: 0.8rem; color: var(--text-sub); height: 1.2em; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* List Area */
        .list-area {
            flex: 1; background: #f8f9fa; overflow-y: auto; padding: 0; position: relative;
        }
        
        .search-container {
            position: sticky; top: 0; background: #f8f9fa; z-index: 20; padding: 10px 1rem 0 1rem;
        }
        .search-box {
            width: 100%; padding: 10px 12px; border: 1px solid #e1e4e8; border-radius: 6px;
            font-size: 0.9rem; outline: none; transition: border 0.2s;
        }
        .search-box:focus { border-color: var(--primary); background: white; }

        .list-container { padding: 1rem; padding-bottom: 2rem; }
        .category-group { margin-bottom: 1.5rem; }
        .category-header {
            position: sticky; top: 0; background: rgba(248, 249, 250, 0.95); backdrop-filter: blur(5px);
            z-index: 10; padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.05);
            margin-bottom: 10px; font-size: 0.85rem; font-weight: 600; color: #4a5568;
            display: flex; align-items: center;
        }
        .category-header::before {
            content: ''; display: block; width: 4px; height: 1em; background: var(--accent);
            margin-right: 8px; border-radius: 2px;
        }
        .item-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px;
        }
        .word-card {
            background: white; border: 1px solid #e1e4e8; border-radius: 6px; padding: 10px 12px;
            cursor: pointer; transition: all 0.15s; display: flex; flex-direction: column;
        }
        .word-card:hover {
            border-color: var(--primary); box-shadow: 0 4px 6px rgba(0,0,0,0.05); transform: translateY(-2px);
        }
        .wc-kanji { font-weight: 500; color: #2d3748; font-size: 1rem; margin-bottom: 3px; }
        .wc-pron { font-size: 0.75rem; color: #718096; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .text-variant { color: var(--danger); }
        .wc-note { font-size: 0.65rem; color: var(--danger); margin-top: 2px; }

        @media (max-width: 768px) {
            .container { height: auto; max-height: none; width: 100%; border-radius: 0; }
            .main-content { flex-direction: column; }
            .left-panel { width: 100%; border-right: none; border-bottom: 1px solid var(--border); padding: 1rem;}
            .item-grid { grid-template-columns: repeat(2, 1fr); }
            header { padding: 1rem; }
            .period-selector { flex-direction: row; overflow-x: auto; padding-bottom: 5px; }
            .period-card { min-width: 200px; flex-shrink: 0; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-titles">
            <h1>ğŸŒ é­å¿—å€­äººä¼ãƒ»å¤ä»£ä¸­å›½èªç™ºéŸ³ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼</h1>
            <div class="subtitle">Ancient Japanese & Chinese Reconstructed Pronunciations</div>
        </div>
    </header>

    <div class="main-content">
        <!-- Sidebar -->
        <div class="left-panel">
            
            <!-- Period Selection -->
            <div>
                <label class="section-label">æ™‚ä»£ãƒ»å†æ§‹ä½“ç³»ã®é¸æŠ</label>
                <div class="period-selector">
                    <label class="period-card" id="card-old" onclick="selectPeriod(this, 'old')">
                        <input type="radio" name="period" value="old">
                        <span class="p-name">æ™©æœŸä¸Šå¤éŸ³ <span class="year-text">~200 BCE</span></span>
                        <span class="p-desc">Baxter-Sagartä½“ç³»</span>
                        <span class="check-icon">âœ”</span>
                    </label>

                    <label class="period-card active" id="card-third" onclick="selectPeriod(this, 'third')">
                        <input type="radio" name="period" value="third" checked>
                        <span class="p-name">3ä¸–ç´€æ¨å®šéŸ³ <span class="year-text">~280 CE</span></span>
                        <span class="p-desc">æ¨å®šãƒ¢ãƒ‡ãƒ«</span>
                        <span class="check-icon">âœ”</span>
                    </label>

                    <label class="period-card" id="card-mid" onclick="selectPeriod(this, 'mid')">
                        <input type="radio" name="period" value="mid">
                        <span class="p-name">ä¸­å¤éŸ³ <span class="year-text">~600 CE</span></span>
                        <span class="p-desc">åˆ‡éŸ»ä½“ç³»</span>
                        <span class="check-icon">âœ”</span>
                    </label>
                </div>
            </div>

            <div class="reference-box">
                ğŸ“š 3ä¸–ç´€æ¨å®šéŸ³ã®è©³ç´°ã¯ã“ã¡ã‚‰:
                <a href="https://masahiromiyazaki.github.io/-ancient-history-of-japan/japanese-phonetics-3rd-century.html" target="_blank" rel="noopener noreferrer">è³‡æ–™ãƒšãƒ¼ã‚¸ã¸ç§»å‹• â†—</a>
            </div>

            <div class="info-box">
                <h4>âš ï¸ ã”åˆ©ç”¨ä¸Šã®æ³¨æ„</h4>
                <ul>
                    <li><strong>èµ¤å­—ã®èªå¥</strong>ï¼ˆé‚ªé¦¬è‡ºåœ‹ãªã©ï¼‰ã¯ã€å¾Œä¸–ã®å²æ›¸ã‚„è¨‚æ­£èª¬ã«åŸºã¥ãè¡¨è¨˜ã§ã™ã€‚</li>
                    <li><strong>ç‰¹æ®Šè¨˜å·ã®å‡¦ç†:</strong> TTSã§å†ç”Ÿå¯èƒ½ãªè¿‘ä¼¼éŸ³ã«ç½®æ›ã•ã‚Œã¾ã™ã€‚</li>
                    <li><strong>ç™ºéŸ³ç²¾åº¦:</strong> ç¾ä»£è‹±èªç­‰ã®ã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚ˆã‚‹è¿‘ä¼¼å†ç”Ÿã§ã‚ã‚Šã€å³å¯†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
                </ul>
            </div>

            <div style="margin-top:auto;">
                <label class="section-label">å†ç”Ÿè¨­å®š</label>
                <div class="audio-controls">
                    <!-- å£°ã®é¸æŠ -->
                    <div class="slider-group">
                        <div class="slider-label"><span>å£°ã®ç¨®é¡ (è‹±èªæ¨å¥¨)</span></div>
                        <select id="voiceSelect" class="voice-select">
                            <option value="">è‡ªå‹•é¸æŠ</option>
                        </select>
                    </div>
                    <div class="slider-group">
                        <div class="slider-label"><span>é€Ÿåº¦</span><span id="rateValue">1.0</span></div>
                        <input type="range" id="rate" min="0.1" max="3" step="0.1" value="1.0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-label"><span>ãƒ”ãƒƒãƒ</span><span id="pitchValue">1.0</span></div>
                        <input type="range" id="pitch" min="0" max="2" step="0.1" value="1.0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-label"><span>éŸ³é‡</span><span id="volumeValue">1.0</span></div>
                        <input type="range" id="volume" min="0" max="1" step="0.1" value="1.0">
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Area -->
        <div class="right-panel">
            
            <!-- Top: Player -->
            <div class="player-area">
                <div class="badge-container">
                    <label class="section-label" style="margin: 0; margin-right: 5px;">ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› (IPAè¨˜å·)</label>
                    <span id="currentWordDisplay" class="selected-word-badge"></span>
                    <span id="currentPeriodDisplay" class="selected-period-badge"></span>
                    
                    <!-- ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ -->
                    <button id="copyUrlBtn" class="sm-btn copy-link-btn" title="ç¾åœ¨ã®URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼">
                        ğŸ”— ã‚³ãƒ”ãƒ¼
                    </button>
                    <!-- Xã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ -->
                    <button id="shareXBtn" class="sm-btn x-share-btn" title="X(Twitter)ã§å…±æœ‰">
                        ğ• ã§å…±æœ‰
                    </button>
                </div>
                
                <div class="input-wrapper">
                    <textarea id="textInput" placeholder="ä¸‹ã®ä¸€è¦§ã‹ã‚‰èªå¥ã‚’é¸æŠã™ã‚‹ã‹ã€IPAã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                </div>
                
                <div id="conversionPreview" class="preview-line"></div>

                <div class="controls-row">
                    <div id="playStatus" class="status-badge">
                        <span id="statusLabel" style="margin-right: auto;">å¾…æ©Ÿä¸­</span>
                        <div class="sound-bars">
                            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-seq" id="historyBtn" title="ä¸Šå¤éŸ³â†’3ä¸–ç´€â†’ä¸­å¤éŸ³ã®é †ã«é€£ç¶šå†ç”Ÿ">ğŸ” å¤‰é·å†ç”Ÿ</button>
                        <button class="btn btn-stop" id="stopBtn">åœæ­¢</button>
                        <button class="btn btn-play" id="speakBtn">â–¶ å†ç”Ÿ</button>
                    </div>
                </div>
            </div>

            <!-- Bottom: List -->
            <div class="list-area">
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” èªå¥ã‚’æ¤œç´¢ (ä¾‹: å‘å¼¥å‘¼, å¥´åœ‹...)">
                </div>
                
                <div class="list-container" id="examplesList">
                    <!-- Javascript will populate this -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// --- Data & Config ---
var synth = window.speechSynthesis;
var voices = [];
var currentAncientPeriod = 'third';
var selectedWordIndex = null; 
var isHistoryPlaying = false; 

var periodNames = {
    'old': 'æ™©æœŸä¸Šå¤éŸ³',
    'third': '3ä¸–ç´€æ¨å®šéŸ³',
    'mid': 'ä¸­å¤éŸ³'
};

var periodOrder = ['old', 'third', 'mid']; 

// Data source
var ancientData = [
    // ä¸»è¦å›½å
    { type: 'ä¸»è¦å›½å', k: 'å°æµ·åœ‹', old: '*tË¤É™j-s-*mÌ¥Ë¤É™Ê”', third: '*tuj-mÉ”Ê”', mid: 'twojH-hmojX' },
    { type: 'ä¸»è¦å›½å', k: 'ä¸€å¤§åœ‹', old: '*Ê”it-*lË¤at-s', third: '*Ê”it-dat', mid: "'jit-dajH" },
    { type: 'ä¸»è¦å›½å', k: 'æœ«ç›§åœ‹', old: '*mË¤at-*ra', third: '*mat-ra', mid: 'mwat-lu' },
    { type: 'ä¸»è¦å›½å', k: 'ä¼Šéƒ½åœ‹', old: '*Ê”ij-*tË¤a', third: '*Ê”ij-tÉ”', mid: "'jij-tuo" },
    { type: 'ä¸»è¦å›½å', k: 'å¥´åœ‹', old: '*nË¤a', third: '*nÉ”', mid: 'nu' },
    { type: 'ä¸»è¦å›½å', k: 'ä¸å½Œåœ‹', old: '*pÉ™-*mij', third: '*pÉ™-mij', mid: 'pjuw-mjie' },
    { type: 'ä¸»è¦å›½å', k: 'æŠ•é¦¬åœ‹', old: '*C.do-*mË¤raÊ”', third: '*do-maÊ”', mid: 'duw-mhaeX' },
    { type: 'ä¸»è¦å›½å', k: 'é‚ªé¦¬å£¹åœ‹', old: '*s-la-*mË¤raÊ”-*Ê”it', third: '*zja-maÊ”-it', mid: "zjia-mhaeX-'jit" },
    { type: 'ä¸»è¦å›½å', k: 'é‚ªé¦¬è‡ºåœ‹', old: '*s-la-*mË¤raÊ”-*lË¤É™', third: '*zja-maÊ”-da', mid: 'zjia-mhaeX-doj', highlight: true, note: 'â€»é­å¿—åŸæ–‡ã¯ã€Œå£¹ã€' },
    { type: 'ä¸»è¦å›½å', k: 'ç‹—å¥´åœ‹', old: '*kË¤oÊ”-*nË¤a', third: '*kÉ”Ê”-nÉ”', mid: 'kuwX-nu' },
    
    // å‚å›½
    { type: 'å‚å›½', k: 'æ–¯é¦¬åœ‹', old: '*sÉ™-*mË¤raÊ”', third: '*sÉ™-maÊ”', mid: 'sje-mhaeX' },
    { type: 'å‚å›½', k: 'å·²ç™¾æ”¯åœ‹', old: '*É¢(r)É™Ê”-*pË¤rak-*kje', third: '*jiÊ”-prak-kje', mid: 'yiX-paek-tsye' },
    { type: 'å‚å›½', k: 'ä¼Šé‚ªåœ‹', old: '*Ê”ij-*s-la', third: '*Ê”ij-zja', mid: "'jij-zjia" },
    { type: 'å‚å›½', k: 'éƒ½æ”¯åœ‹', old: '*tË¤a-*kje', third: '*tÉ”-kje', mid: 'tuo-tsye' },
    { type: 'å‚å›½', k: 'å½Œå¥´åœ‹', old: '*mij-*nË¤a', third: '*mij-nÉ”', mid: 'mjie-nu' },
    { type: 'å‚å›½', k: 'å¥½å¤éƒ½åœ‹', old: '*qÊ°Ë¤uÊ”-*kË¤aÊ”-*tË¤a', third: '*xoÊ”-kÉ”Ê”-tÉ”', mid: 'huwX-kuX-tuo' },
    { type: 'å‚å›½', k: 'ä¸å‘¼åœ‹', old: '*pÉ™-*qÊ°Ë¤a', third: '*pÉ™-qÉ”', mid: 'pjuw-hu' },
    { type: 'å‚å›½', k: 'å§å¥´åœ‹', old: '*tsajÊ”-*nË¤a', third: '*tsjaÊ”-nÉ”', mid: 'tsjoX-nu' },
    { type: 'å‚å›½', k: 'å°è˜‡åœ‹', old: '*tË¤É™j-s-*sË¤a', third: '*tuj-sÉ”', mid: 'twojH-su' },
    { type: 'å‚å›½', k: 'è˜‡å¥´åœ‹', old: '*sË¤a-*nË¤a', third: '*sÉ”-nÉ”', mid: 'su-nu' },
    { type: 'å‚å›½', k: 'å‘¼é‚‘åœ‹', old: '*qÊ°Ë¤a-*Ê”ip', third: '*qÉ”-Ê”ip', mid: "hu-'ip" },
    { type: 'å‚å›½', k: 'è¯å¥´è˜‡å¥´åœ‹', old: '*qÊ·Ë¤ra-*nË¤a-*sË¤a-*nË¤a', third: '*qÊ·aj-nÉ”-sÉ”-nÉ”', mid: 'hwa-nu-su-nu' },
    { type: 'å‚å›½', k: 'é¬¼åœ‹', old: '*qÊ·É™jÊ”', third: '*kujÊ”', mid: 'kjwijX' },
    { type: 'å‚å›½', k: 'çˆ²å¾åœ‹', old: '*É¢Ê·aj-*Å‹Ë¤a', third: '*wÉ™j-Å‹É”', mid: 'hjwe-ngu' },
    { type: 'å‚å›½', k: 'é¬¼å¥´åœ‹', old: '*qÊ·É™jÊ”-*nË¤a', third: '*kujÊ”-nÉ”', mid: 'kjwijX-nu' },
    { type: 'å‚å›½', k: 'é‚ªé¦¬åœ‹', old: '*s-la-*mË¤raÊ”', third: '*zja-maÊ”', mid: 'zjia-mhaeX' },
    { type: 'å‚å›½', k: 'èº¬è‡£åœ‹', old: '*kÊ·É™Å‹-*[g]in', third: '*kuÅ‹-gin', mid: 'kjuwng-zyin' },
    { type: 'å‚å›½', k: 'å·´åˆ©åœ‹', old: '*prË¤aj-*C.ri[t]-s', third: '*paj-riÊ”', mid: 'pae-lijH' },
    { type: 'å‚å›½', k: 'æ”¯æƒŸåœ‹', old: '*kje-*C.wij', third: '*kje-wij', mid: 'tsye-ywij' },
    { type: 'å‚å›½', k: 'çƒå¥´åœ‹', old: '*Ê”Ë¤a-*nË¤a', third: '*Ê”É”-nÉ”', mid: "'u-nu" },

    // äººå
    { type: 'äººå', k: 'å‘å½Œå‘¼', old: '*pe-*mij-*qÊ°Ë¤a', third: '*pij-mij-qÉ”', mid: 'pjie-mjie-hu' },
    { type: 'äººå', k: 'å£¹èˆ‡', old: '*Ê”it-*laÊ”', third: '*Ê”it-jo', mid: "'jit-yoX" },
    { type: 'äººå', k: 'è‡ºèˆ‡', old: '*lË¤É™-*laÊ”', third: '*da-jo', mid: 'doj-yoX', highlight: true, note: 'â€»é­å¿—åŸæ–‡ã¯ã€Œå£¹ã€' },
    { type: 'äººå', k: 'é›£å‡ç±³', old: '*nË¤an-*s-tÉ™Å‹-*mË¤ejÊ”', third: '*nan-s(j)É™Å‹-mÉ™jÊ”', mid: 'nan-sying-mejX' },
    { type: 'äººå', k: 'éƒ½å¸‚ç‰›åˆ©', old: '*tË¤a-*d(r)É™Ê”-*Å‹Ê·a-*C.ri[t]-s', third: '*tÉ”-dÊ‘iÊ”-Å‹o-raj', mid: 'tuo-dzyiX-ngjuw-lijH' },
    { type: 'äººå', k: 'ä¼Šè²è€†', old: '*Ê”ij-*lÌ¥eÅ‹-*[g]ij', third: '*Ê”ij-s(j)eÅ‹-gij', mid: "'jij-syeng-gij" },
    { type: 'äººå', k: 'æ–é‚ªç‹—', old: '*lak-*s-la-*kË¤oÊ”', third: '*jak-zja-kÉ”Ê”', mid: 'yek-zjia-kuwX' },
    { type: 'äººå', k: 'è¼‰æ–¯çƒè¶Š', old: '*tsË¤É™Ê”-*sÉ™-*Ê”Ë¤a-*É¢Ê·at', third: '*tsÉ™Ê”-se-Ê”É”-É¢Ê·at', mid: "tsojH-sje-'u-hwat" },
    { type: 'äººå', k: 'å‘å½Œå¼“å‘¼', old: '*pe-*mij-*kÊ·É™Å‹-*qÊ°Ë¤a', third: '*pij-mij-k(r)uÅ‹-qÉ”', mid: 'pjie-mjie-kjuwng-hu' },

    // å®˜è·å
    { type: 'å®˜è·å', k: 'å‘ç‹—', old: '*pe-*kË¤oÊ”', third: '*pij-kÉ”Ê”', mid: 'pjie-kuwX' },
    { type: 'å®˜è·å', k: 'å‘å¥´æ¯é›¢', old: '*pe-*nË¤a-*mË¤É™Ê”-*C.raj', third: '*pij-nÉ”-moÊ”-raj', mid: 'pjie-nu-muwX-ljej' },
    { type: 'å®˜è·å', k: 'çˆ¾æ”¯', old: '*neÊ”-*kje', third: '*ne-kje', mid: 'nyeX-tsye' },
    { type: 'å®˜è·å', k: 'æ³„è¬¨è§š', old: '*ljet-*ma-*kË¤a', third: '*set-ma-kÉ”', mid: 'sjet-mu-ku' },
    { type: 'å®˜è·å', k: 'æŸ„æ¸ è§š', old: '*praÅ‹Ê”-*g(r)a-*kË¤a', third: '*pjaÅ‹-gja-kÉ”', mid: 'pjaengX-gja-ku' },
    { type: 'å®˜è·å', k: 'å…•é¦¬è§š', old: '*s.É¢ijÊ”-*mË¤raÊ”-*kË¤a', third: '*ziÊ”-maÊ”-kÉ”', mid: 'zijX-mhaeX-ku' },
    { type: 'å®˜è·å', k: 'å¤šæ¨¡', old: '*tË¤aj-*ma', third: '*tË¤aj-mÉ”', mid: 'ta-mu' },
    { type: 'å®˜è·å', k: 'å½Œå½Œ', old: '*mij-*mij', third: '*mij-mij', mid: 'mjie-mjie' },
    { type: 'å®˜è·å', k: 'å½Œå½Œé‚£åˆ©', old: '*mij-*mij-*nË¤aj-*C.ri[t]-s', third: '*mij-mij-nÉ”-raj', mid: 'mjie-mjie-na-lijH' },
    { type: 'å®˜è·å', k: 'ä¼Šæ”¯é¦¬', old: '*Ê”ij-*kje-*mË¤raÊ”', third: '*Ê”ij-kje-maÊ”', mid: "'jij-tsye-mhaeX" },
    { type: 'å®˜è·å', k: 'å½Œé¦¬å‡', old: '*mij-*mË¤raÊ”-*s-tÉ™Å‹', third: '*mij-maÊ”-s(j)É™Å‹', mid: 'mjie-mhaeX-sying' },
    { type: 'å®˜è·å', k: 'å½Œé¦¬ç²æ”¯', old: '*mij-*mË¤raÊ”-*É¢Ê·Ë¤rek-*kje', third: '*mij-maÊ”-É¢Ê·Ë¤ek-kje', mid: 'mjie-mhaeX-hwak-tsye' },
    { type: 'å®˜è·å', k: 'å¥´ä½³é®', old: '*nË¤a-*kË¤re-*tij', third: '*nÉ”-kaj-tej', mid: 'nu-kea-tej' },
    { type: 'å®˜è·å', k: 'ç‹—å¤æ™ºå‘ç‹—', old: '*kË¤oÊ”-*kË¤aÊ”-*trje-*pe-*kË¤oÊ”', third: '*kÉ”Ê”-kÉ”Ê”-tij-pij-kÉ”Ê”', mid: 'kuwX-kuX-tsye-pjie-kuwX' },
    { type: 'å®˜è·å', k: 'å¤§å€­', old: '*lË¤at-s-*Ê”Ê·aj', third: '*dat-Ê”waj', mid: "dajH-'uaj" }
];

var ipaToSpeech = {
    // æ¯éŸ³è¨­å®š
    'É‘': 'a', 'Ã¦': 'a', 'ÊŒ': 'u', 'É’': 'o', 'É”': 'o', 
    'É™': 'u', 'É›': 'e', 'Å“': 'u', 'Éª': 'i',
    'É¨': 'i', 'É¯': 'u', 'ÊŠ': 'u', 'Ã¸': 'eu', 
    'u': 'oo', 'i': 'ee', 'e': 'e', 'o': 'o', 'a': 'a',
    'jij': 'yee', 'tuo': 'to',
    'ja': 'ya', 'ju': 'yu', 'jo': 'yo', 'je': 'ie', 'ji': 'yee', 
    'jÉ™': 'yu', 'É™j': 'ui', 'j': 'i', 'y': 'y', 
    's.': 'su', 'mÌ¥': 'hm', 'nÌ¥': 'hn', 'lÌ¥': 'hl',
    'Êƒ': 'sh', 'Ê’': 'zh', 'Î¸': 'th', 'Ã°': 'dh', 'Å‹': 'ng', 
    'Ê”': '', 'É¡': 'g', 'Ã§': 'hy', 'x': 'kh', 'É£': 'gh',
    'Ï‡': 'kh', 'Ê': 'r', 'Î²': 'v', 'É¸': 'f', 
    'Ê': 'li', 'É²': 'ny', 'Ê§': 'ch', 'Ê¤': 'j', 
    'ts': 'z', 'dz': 'dz', 'Ê‘': 'zh', 'É¢': 'g', 'mw': 'mu',
    'Ê·': 'u', 'hw': 'hu', 'w': 'w', 'kw': 'ku', 'gw': 'gu',
    'Ë¤': '', 'Ê°': 'h', 'Ê²': 'y', 'Ë': '', 'Ëˆ': '', 'ËŒ': '', '.': '', 
    '[': '', ']': '', '/': '', '*': '', '~': '', 'q': 'k', 
    '-': '', 'C.': '', 'X': '', 'H': '', "'": '', ' ': ' ', '(': '', ')': ''
};

// --- UI Logic ---

// â˜…è¿½åŠ : æ‰‹å…¥åŠ›å¯¾å¿œã®URLæ›´æ–°
function updateUrlState() {
    var url = new URL(window.location);
    url.searchParams.set('period', currentAncientPeriod);
    
    // ç¾åœ¨ã®ãƒ†ã‚­ã‚¹ãƒˆ
    var currentText = document.getElementById('textInput').value.trim();

    if (selectedWordIndex !== null) {
        // å˜èªãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆ
        url.searchParams.set('word', ancientData[selectedWordIndex].k);
        url.searchParams.delete('text'); // text paramã¯æ¶ˆã™
    } else if (currentText !== "") {
        // æ‰‹å…¥åŠ›ã®å ´åˆ
        url.searchParams.delete('word'); // word paramã¯æ¶ˆã™
        url.searchParams.set('text', currentText);
    } else {
        // ç©ºã®å ´åˆ
        url.searchParams.delete('word');
        url.searchParams.delete('text');
    }
    
    window.history.replaceState(null, '', url);
}

function copyCurrentUrl() {
    var url = window.location.href;
    navigator.clipboard.writeText(url).then(function() {
        var btn = document.getElementById('copyUrlBtn');
        var originalText = btn.textContent;
        btn.textContent = "âœ…";
        btn.classList.add('copied');
        setTimeout(function() {
            btn.textContent = originalText;
            btn.classList.remove('copied');
        }, 2000);
    });
}

function shareOnX() {
    var url = window.location.href;
    var text = "å¤ä»£æ—¥æœ¬èª/ä¸­å›½èªã®ç™ºéŸ³ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼";
    
    if (selectedWordIndex !== null) {
        var data = ancientData[selectedWordIndex];
        text = `ã€Œ${data.k}ã€ã®${periodNames[currentAncientPeriod]}ã®ç™ºéŸ³`;
    } else {
        // â˜…è¿½åŠ : æ‰‹å…¥åŠ›æ™‚ã®ã‚·ã‚§ã‚¢æ–‡è¨€
        var manualText = document.getElementById('textInput').value.trim();
        if (manualText) {
            text = `IPAã€Œ${manualText}ã€ã®${periodNames[currentAncientPeriod]}ã®ç™ºéŸ³`;
        }
    }
    
    var shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}&hashtags=å¤ä»£æ—¥æœ¬èª,é‚ªé¦¬å°å›½`;
    window.open(shareUrl, '_blank');
}

function populateVoiceList() {
    voices = synth.getVoices();
    var voiceSelect = document.getElementById('voiceSelect');
    voiceSelect.innerHTML = '<option value="">è‡ªå‹•é¸æŠ (æ¨å¥¨)</option>';
    
    voices.forEach(function(voice, index) {
        if (voice.lang.indexOf('en') === 0) { 
            var option = document.createElement('option');
            option.textContent = `${voice.name} (${voice.lang})`;
            option.value = index;
            voiceSelect.appendChild(option);
        }
    });
}

function updateBadges(wordText, isHighlight) {
    var wordBadge = document.getElementById('currentWordDisplay');
    var periodBadge = document.getElementById('currentPeriodDisplay');

    if (!wordText && selectedWordIndex === null) {
        wordBadge.style.display = 'none';
        periodBadge.style.display = 'none';
    } else {
        wordBadge.textContent = 'èªå¥: ' + wordText;
        wordBadge.style.display = 'inline-block';
        wordBadge.style.color = isHighlight ? 'var(--danger)' : 'var(--primary-dark)';
        periodBadge.textContent = 'ä½“ç³»: ' + periodNames[currentAncientPeriod];
        periodBadge.style.display = 'inline-block';
    }
}

function selectPeriod(cardElementOrId, period) {
    var card;
    if (typeof cardElementOrId === 'string') {
        card = document.getElementById(cardElementOrId);
    } else {
        card = cardElementOrId;
    }

    document.querySelectorAll('.period-card').forEach(el => el.classList.remove('active'));
    if (card) card.classList.add('active');
    
    if (card) {
        var radio = card.querySelector('input');
        if (radio) radio.checked = true;
    }
    
    currentAncientPeriod = period;
    
    if (selectedWordIndex !== null) {
        var data = ancientData[selectedWordIndex];
        var newPron = data[currentAncientPeriod];
        
        updateBadges(data.k, data.highlight);
        
        if (newPron && newPron !== "(ãƒ‡ãƒ¼ã‚¿ãªã—)") {
            document.getElementById('textInput').value = newPron;
            updatePreview();
            if (!isHistoryPlaying) {
                setTimeout(speak, 50); 
            }
        }
    }
    
    // URLæ›´æ–°
    updateUrlState();
    
    var searchTerm = document.getElementById('searchInput').value;
    updateAncientExamples(searchTerm);
    updatePreview();
}

function updateAncientExamples(filterTerm) {
    var container = document.getElementById('examplesList');
    container.innerHTML = '';
    
    var types = ['ä¸»è¦å›½å', 'å‚å›½', 'äººå', 'å®˜è·å']; 
    
    types.forEach(function(type) {
        var filteredItems = ancientData.filter(function(d) {
            if (d.type !== type) return false;
            if (!filterTerm) return true;
            return d.k.includes(filterTerm) || 
                   (d.old && d.old.includes(filterTerm)) ||
                   (d.third && d.third.includes(filterTerm)) ||
                   (d.mid && d.mid.includes(filterTerm));
        });

        if (filteredItems.length === 0) return;

        var group = document.createElement('div');
        group.className = 'category-group';
        
        var header = document.createElement('div');
        header.className = 'category-header';
        header.textContent = type;
        group.appendChild(header);
        
        var grid = document.createElement('div');
        grid.className = 'item-grid';
        
        filteredItems.forEach(function(data) {
            var originalIndex = ancientData.indexOf(data);
            var pron = data[currentAncientPeriod] || "(ãƒ‡ãƒ¼ã‚¿ãªã—)";
            var kanjiClass = data.highlight ? 'wc-kanji text-variant' : 'wc-kanji';
            var noteHtml = data.highlight ? `<div class="wc-note">${data.note}</div>` : '';
            
            var card = document.createElement('div');
            card.className = 'word-card';
            card.innerHTML = `
                <div class="${kanjiClass}">${data.k}</div>
                <div class="wc-pron">${pron}</div>
                ${noteHtml}
            `;
            
            card.onclick = function() {
                if (isHistoryPlaying) stopHistory();
                if (pron && pron !== "(ãƒ‡ãƒ¼ã‚¿ãªã—)") {
                    selectedWordIndex = originalIndex;
                    updateBadges(data.k, data.highlight);
                    document.getElementById('textInput').value = pron;
                    updatePreview();
                    updateUrlState(); // URLæ›´æ–°
                    speak(); 
                }
            };
            grid.appendChild(card);
        });
        
        group.appendChild(grid);
        container.appendChild(group);
    });
}

function convertIPAToSpeech(text) {
    var result = text;
    var keys = Object.keys(ipaToSpeech);
    keys.sort(function(a, b) { return b.length - a.length; });
    for (var i = 0; i < keys.length; i++) {
        var ipa = keys[i];
        var replacement = ipaToSpeech[ipa];
        if (replacement !== undefined) {
            var escaped = ipa.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            var reg = new RegExp(escaped, 'g');
            result = result.replace(reg, replacement);
        }
    }
    return result.toLowerCase();
}

function updatePreview() {
    var text = document.getElementById('textInput').value;
    var previewDiv = document.getElementById('conversionPreview');
    previewDiv.textContent = text.trim() ? 'èª­ä¸Šã’ç”¨å¤‰æ›: ' + convertIPAToSpeech(text) : '';
}

function updateValue(id) {
    document.getElementById(id + 'Value').textContent = document.getElementById(id).value;
}

function setStatus(isPlaying) {
    var statusContainer = document.getElementById('playStatus');
    var statusLabel = document.getElementById('statusLabel');
    if (isPlaying) {
        statusContainer.classList.add('playing');
        statusLabel.textContent = "å†ç”Ÿä¸­...";
    } else {
        statusContainer.classList.remove('playing');
        statusLabel.textContent = "å¾…æ©Ÿä¸­";
    }
}

function speak(onEndCallback) {
    if (synth.speaking) synth.cancel();
    setStatus(false);

    var text = document.getElementById('textInput').value;
    if (!text.trim()) {
        if (onEndCallback) onEndCallback();
        return;
    }
    
    var textToSpeak = convertIPAToSpeech(text);
    var utterance = new SpeechSynthesisUtterance(textToSpeak);
    utterance.rate = parseFloat(document.getElementById('rate').value);
    utterance.pitch = parseFloat(document.getElementById('pitch').value);
    utterance.volume = parseFloat(document.getElementById('volume').value);
    
    var voiceSelect = document.getElementById('voiceSelect');
    var selectedVoiceIndex = voiceSelect.value;
    
    if (selectedVoiceIndex !== "") {
        utterance.voice = voices[selectedVoiceIndex];
    } else {
        var enVoice = null;
        if (voices.length > 0) {
            for (var i = 0; i < voices.length; i++) {
                if (voices[i].lang === 'en-US') { enVoice = voices[i]; break; }
            }
            if (!enVoice) {
                for (var i = 0; i < voices.length; i++) {
                    if (voices[i].lang.indexOf('en') === 0) { enVoice = voices[i]; break; }
                }
            }
            if (enVoice) utterance.voice = enVoice;
        }
    }

    utterance.onstart = function() { setStatus(true); };
    utterance.onend = function() { 
        setStatus(false);
        if (onEndCallback) onEndCallback();
    };
    utterance.onerror = function(e) {
        console.error("Speech Error:", e);
        setStatus(false);
        if (onEndCallback) onEndCallback();
    };

    synth.speak(utterance);
}

function stopSpeech() { 
    synth.cancel(); 
    setStatus(false);
    stopHistory();
}

function playHistory() {
    if (selectedWordIndex === null) {
        alert("å…ˆã«ä¸€è¦§ã‹ã‚‰èªå¥ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
        return;
    }
    if (isHistoryPlaying) return; 

    isHistoryPlaying = true;
    document.getElementById('historyBtn').classList.add('active');
    document.getElementById('historyBtn').textContent = "â¬› åœæ­¢";

    var sequence = ['old', 'third', 'mid'];
    var seqIndex = 0;

    function playNextStep() {
        if (!isHistoryPlaying) return;
        if (seqIndex >= sequence.length) {
            stopHistory(); 
            return;
        }

        var p = sequence[seqIndex];
        selectPeriod('card-' + p, p);
        
        setTimeout(function() {
            if (!isHistoryPlaying) return;
            speak(function() {
                seqIndex++;
                setTimeout(playNextStep, 800); 
            });
        }, 500);
    }
    playNextStep();
}

function stopHistory() {
    isHistoryPlaying = false;
    document.getElementById('historyBtn').classList.remove('active');
    document.getElementById('historyBtn').textContent = "ğŸ” å¤‰é·å†ç”Ÿ";
}

function toggleHistory() {
    if (isHistoryPlaying) {
        stopSpeech(); 
    } else {
        playHistory();
    }
}

// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰åˆæœŸçŠ¶æ…‹ã‚»ãƒƒãƒˆ
function checkUrlParams() {
    var params = new URLSearchParams(window.location.search);
    var word = params.get('word');
    var period = params.get('period');
    var textParam = params.get('text'); // â˜…è¿½åŠ 

    if (period && ['old', 'third', 'mid'].includes(period)) {
        selectPeriod('card-' + period, period);
    }

    if (word) {
        var index = ancientData.findIndex(function(d) {
            return d.k === word;
        });
        
        if (index !== -1) {
            selectedWordIndex = index;
            var data = ancientData[index];
            var pron = data[currentAncientPeriod];
            
            updateBadges(data.k, data.highlight);
            if (pron) {
                document.getElementById('textInput').value = pron;
                updatePreview();
            }
            document.getElementById('searchInput').value = word;
            updateAncientExamples(word);
        }
    } else if (textParam) {
        // â˜…è¿½åŠ : æ‰‹å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã®å¾©å…ƒ
        document.getElementById('textInput').value = textParam;
        updatePreview();
    }
}

function init() {
    document.getElementById('speakBtn').onclick = function() { speak(); };
    document.getElementById('stopBtn').onclick = stopSpeech;
    document.getElementById('historyBtn').onclick = toggleHistory;
    document.getElementById('copyUrlBtn').onclick = copyCurrentUrl;
    document.getElementById('shareXBtn').onclick = shareOnX;
    
    document.getElementById('searchInput').addEventListener('input', function(e) {
        updateAncientExamples(e.target.value);
    });
    
    document.getElementById('textInput').oninput = function() {
        selectedWordIndex = null;
        updateBadges(null);
        updatePreview();
        updateUrlState(); // â˜…æ‰‹å…¥åŠ›æ™‚ã«URLæ›´æ–°
        if (isHistoryPlaying) stopHistory();
    };
    
    ['rate', 'pitch', 'volume'].forEach(id => {
        document.getElementById(id).oninput = function() { updateValue(id); };
    });
    
    document.addEventListener('keydown', function(e) {
        if (e.target.tagName !== 'TEXTAREA' && e.target.tagName !== 'INPUT') {
            if (e.code === 'Space') {
                e.preventDefault();
                if (synth.speaking) stopSpeech();
                else speak();
            }
        }
    });

    populateVoiceList();
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = populateVoiceList;
    }
    
    updateAncientExamples();
    checkUrlParams(); 
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}
</script>
</body>
</html>